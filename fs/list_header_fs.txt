STATE before_parse
    CREATE self_referential_struct_name ""
    CREATE self_referential_ptrs []
END_STATE


STATE structures_and_unions
    USE_GLOBAL self_referential_struct_name
    USE_GLOBAL self_referential_ptrs
    IF 'struct' IN EXP
        IF self_referential_struct_name EQUALTO ""
            FOR memb IN STRUCT_MEMBERS
                SET t "type"
                SET d "declarators"
                INDEX memb t
                INDEX memb d
                IF NAME IN memb_t
                    FOR i IN range(len(memb_d))
                        INDEX memb_d i
                        IF memb_d_i EQUALTO '*'
                            SET next_ind i+1
                            INDEX memb_d next_ind
                            APPEND self_referential_ptrs memb_d_next_ind
                            SET self_referential_struct_name NAME
                        END_IF
                    END_FOR
                END_IF
            END_FOR
        END_IF
    END_IF
END_STATE

STATE after_parse
    VIOLATION In the end:
    PRINT self_referential_struct_name
    PRINT self_referential_ptrs
END_STATE



